{"ast":null,"code":"import _objectSpread from\"C:/Program Files/find_my_lover/src/main/reactjs/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Program Files/find_my_lover/src/main/reactjs/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Program Files/find_my_lover/src/main/reactjs/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Program Files/find_my_lover/src/main/reactjs/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useRef,useState,useEffect}from'react';import useAuth from'../hooks/useAuth';import{Link,useNavigate,useLocation}from'react-router-dom';import useInput from'../hooks/useInput';import useToggle from'../hooks/useToggle';import axios from'../api/axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LOGIN_URL='/auth';var Login=function Login(){var _location$state,_location$state$from;var _useAuth=useAuth(),setAuth=_useAuth.setAuth;var navigate=useNavigate();var location=useLocation();var from=((_location$state=location.state)===null||_location$state===void 0?void 0:(_location$state$from=_location$state.from)===null||_location$state$from===void 0?void 0:_location$state$from.pathname)||\"/\";var userRef=useRef();var errRef=useRef();var _useInput=useInput('user',''),_useInput2=_slicedToArray(_useInput,3),user=_useInput2[0],resetUser=_useInput2[1],userAttribs=_useInput2[2];var _useState=useState(''),_useState2=_slicedToArray(_useState,2),pwd=_useState2[0],setPwd=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),errMsg=_useState4[0],setErrMsg=_useState4[1];var _useToggle=useToggle('persist',false),_useToggle2=_slicedToArray(_useToggle,2),check=_useToggle2[0],toggleCheck=_useToggle2[1];useEffect(function(){userRef.current.focus();},[]);useEffect(function(){setErrMsg('');},[user,pwd]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _response$data,_response$data2,response,accessToken,roles,_err$response,_err$response2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return axios.post(LOGIN_URL,JSON.stringify({user:user,pwd:pwd}),{headers:{'Content-Type':'application/json'},withCredentials:true});case 4:response=_context.sent;accessToken=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.accessToken;roles=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.roles;setAuth({user:user,pwd:pwd,roles:roles,accessToken:accessToken});resetUser();setPwd('');navigate(from,{replace:true});_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);if(!(_context.t0!==null&&_context.t0!==void 0&&_context.t0.response)){setErrMsg('No Server Response');}else if(((_err$response=_context.t0.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setErrMsg('Missing Username or Password');}else if(((_err$response2=_context.t0.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setErrMsg('Unauthorized');}else{setErrMsg('Login Failed');}errRef.current.focus();case 17:case\"end\":return _context.stop();}}},_callee,null,[[1,13]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errMsg?\"errmsg\":\"offscreen\",\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsx(\"h1\",{children:\"\\uB85C\\uADF8\\uC778\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",children:\"\\uC544\\uC774\\uB514:\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"text\",id:\"username\",ref:userRef,autoComplete:\"off\"},userAttribs),{},{required:true})),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"\\uBE44\\uBC00\\uBC88\\uD638:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"password\",onChange:function onChange(e){return setPwd(e.target.value);},value:pwd,required:true}),/*#__PURE__*/_jsx(\"button\",{children:\"\\uB85C\\uADF8\\uC778\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC544\\uC9C1 \\uD68C\\uC6D0\\uC774 \\uC544\\uB2C8\\uC2E0\\uAC00\\uC694?\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"line\",children:/*#__PURE__*/_jsx(Link,{to:\"/register\",children:\"\\uD68C\\uC6D0\\uAC00\\uC785\\uD558\\uAE30\"})})]})]});};export default Login;","map":{"version":3,"names":["useRef","useState","useEffect","useAuth","Link","useNavigate","useLocation","useInput","useToggle","axios","LOGIN_URL","Login","setAuth","navigate","location","from","state","pathname","userRef","errRef","user","resetUser","userAttribs","pwd","setPwd","errMsg","setErrMsg","check","toggleCheck","current","focus","handleSubmit","e","preventDefault","post","JSON","stringify","headers","withCredentials","response","accessToken","data","roles","replace","status","target","value"],"sources":["C:/Program Files/find_my_lover/src/main/reactjs/src/components/Login.js"],"sourcesContent":["import { useRef, useState, useEffect } from 'react';\r\nimport useAuth from '../hooks/useAuth';\r\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\r\nimport useInput from '../hooks/useInput';\r\nimport useToggle from '../hooks/useToggle';\r\n\r\nimport axios from '../api/axios';\r\nconst LOGIN_URL = '/auth';\r\n\r\nconst Login = () => {\r\n    const { setAuth } = useAuth();\r\n\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const from = location.state?.from?.pathname || \"/\";\r\n\r\n    const userRef = useRef();\r\n    const errRef = useRef();\r\n\r\n    const [user, resetUser, userAttribs] = useInput('user', '')\r\n    const [pwd, setPwd] = useState('');\r\n    const [errMsg, setErrMsg] = useState('');\r\n    const [check, toggleCheck] = useToggle('persist', false);\r\n\r\n    useEffect(() => {\r\n        userRef.current.focus();\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        setErrMsg('');\r\n    }, [user, pwd])\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await axios.post(LOGIN_URL,\r\n                JSON.stringify({ user, pwd }),\r\n                {\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    withCredentials: true\r\n                }\r\n            );\r\n            const accessToken = response?.data?.accessToken;\r\n            const roles = response?.data?.roles;\r\n            setAuth({ user, pwd, roles, accessToken });\r\n            resetUser();\r\n            setPwd('');\r\n            navigate(from, { replace: true });\r\n        } catch (err) {\r\n            if (!err?.response) {\r\n                setErrMsg('No Server Response');\r\n            } else if (err.response?.status === 400) {\r\n                setErrMsg('Missing Username or Password');\r\n            } else if (err.response?.status === 401) {\r\n                setErrMsg('Unauthorized');\r\n            } else {\r\n                setErrMsg('Login Failed');\r\n            }\r\n            errRef.current.focus();\r\n        }\r\n    }\r\n\r\n    return (\r\n\r\n        <section>\r\n            <p ref={errRef} className={errMsg ? \"errmsg\" : \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\r\n            <h1>로그인</h1>\r\n            <form onSubmit={handleSubmit}>\r\n                <label htmlFor=\"username\">아이디:</label>\r\n                <input\r\n                    type=\"text\"\r\n                    id=\"username\"\r\n                    ref={userRef}\r\n                    autoComplete=\"off\"\r\n                    {...userAttribs}\r\n                    required\r\n                />\r\n\r\n                <label htmlFor=\"password\">비밀번호:</label>\r\n                <input\r\n                    type=\"password\"\r\n                    id=\"password\"\r\n                    onChange={(e) => setPwd(e.target.value)}\r\n                    value={pwd}\r\n                    required\r\n                />\r\n                <button>로그인</button>\r\n                {/* <div className=\"persistCheck\">\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        id=\"persist\"\r\n                        onChange={toggleCheck}\r\n                        checked={check}\r\n                    />\r\n                    <label htmlFor=\"persist\">Trust This Device</label>\r\n                </div> */}\r\n            </form>\r\n            <p>\r\n                아직 회원이 아니신가요?<br />\r\n                <span className=\"line\">\r\n                    <Link to=\"/register\">회원가입하기</Link>\r\n                </span>\r\n            </p>\r\n        </section>\r\n\r\n    )\r\n}\r\n\r\nexport default Login\r\n"],"mappings":"miBAAA,OAASA,MAAT,CAAiBC,QAAjB,CAA2BC,SAA3B,KAA4C,OAA5C,CACA,MAAOC,QAAP,KAAoB,kBAApB,CACA,OAASC,IAAT,CAAeC,WAAf,CAA4BC,WAA5B,KAA+C,kBAA/C,CACA,MAAOC,SAAP,KAAqB,mBAArB,CACA,MAAOC,UAAP,KAAsB,oBAAtB,CAEA,MAAOC,MAAP,KAAkB,cAAlB,C,wFACA,GAAMC,UAAS,CAAG,OAAlB,CAEA,GAAMC,MAAK,CAAG,QAARA,MAAQ,EAAM,0CAChB,aAAoBR,OAAO,EAA3B,CAAQS,OAAR,UAAQA,OAAR,CAEA,GAAMC,SAAQ,CAAGR,WAAW,EAA5B,CACA,GAAMS,SAAQ,CAAGR,WAAW,EAA5B,CACA,GAAMS,KAAI,CAAG,kBAAAD,QAAQ,CAACE,KAAT,gFAAgBD,IAAhB,oEAAsBE,QAAtB,GAAkC,GAA/C,CAEA,GAAMC,QAAO,CAAGlB,MAAM,EAAtB,CACA,GAAMmB,OAAM,CAAGnB,MAAM,EAArB,CAEA,cAAuCO,QAAQ,CAAC,MAAD,CAAS,EAAT,CAA/C,wCAAOa,IAAP,eAAaC,SAAb,eAAwBC,WAAxB,eACA,cAAsBrB,QAAQ,CAAC,EAAD,CAA9B,wCAAOsB,GAAP,eAAYC,MAAZ,eACA,eAA4BvB,QAAQ,CAAC,EAAD,CAApC,yCAAOwB,MAAP,eAAeC,SAAf,eACA,eAA6BlB,SAAS,CAAC,SAAD,CAAY,KAAZ,CAAtC,0CAAOmB,KAAP,gBAAcC,WAAd,gBAEA1B,SAAS,CAAC,UAAM,CACZgB,OAAO,CAACW,OAAR,CAAgBC,KAAhB,GACH,CAFQ,CAEN,EAFM,CAAT,CAIA5B,SAAS,CAAC,UAAM,CACZwB,SAAS,CAAC,EAAD,CAAT,CACH,CAFQ,CAEN,CAACN,IAAD,CAAOG,GAAP,CAFM,CAAT,CAIA,GAAMQ,aAAY,4FAAG,iBAAOC,CAAP,+MACjBA,CAAC,CAACC,cAAF,GADiB,sCAIUxB,MAAK,CAACyB,IAAN,CAAWxB,SAAX,CACnByB,IAAI,CAACC,SAAL,CAAe,CAAEhB,IAAI,CAAJA,IAAF,CAAQG,GAAG,CAAHA,GAAR,CAAf,CADmB,CAEnB,CACIc,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CADb,CAEIC,eAAe,CAAE,IAFrB,CAFmB,CAJV,QAIPC,QAJO,eAWPC,WAXO,CAWOD,QAXP,SAWOA,QAXP,iCAWOA,QAAQ,CAAEE,IAXjB,yCAWO,eAAgBD,WAXvB,CAYPE,KAZO,CAYCH,QAZD,SAYCA,QAZD,kCAYCA,QAAQ,CAAEE,IAZX,0CAYC,gBAAgBC,KAZjB,CAab9B,OAAO,CAAC,CAAEQ,IAAI,CAAJA,IAAF,CAAQG,GAAG,CAAHA,GAAR,CAAamB,KAAK,CAALA,KAAb,CAAoBF,WAAW,CAAXA,WAApB,CAAD,CAAP,CACAnB,SAAS,GACTG,MAAM,CAAC,EAAD,CAAN,CACAX,QAAQ,CAACE,IAAD,CAAO,CAAE4B,OAAO,CAAE,IAAX,CAAP,CAAR,CAhBa,iFAkBb,GAAI,4CAAC,YAAKJ,QAAN,CAAJ,CAAoB,CAChBb,SAAS,CAAC,oBAAD,CAAT,CACH,CAFD,IAEO,IAAI,4BAAIa,QAAJ,sDAAcK,MAAd,IAAyB,GAA7B,CAAkC,CACrClB,SAAS,CAAC,8BAAD,CAAT,CACH,CAFM,IAEA,IAAI,6BAAIa,QAAJ,wDAAcK,MAAd,IAAyB,GAA7B,CAAkC,CACrClB,SAAS,CAAC,cAAD,CAAT,CACH,CAFM,IAEA,CACHA,SAAS,CAAC,cAAD,CAAT,CACH,CACDP,MAAM,CAACU,OAAP,CAAeC,KAAf,GA3Ba,qEAAH,kBAAZC,aAAY,4CAAlB,CA+BA,mBAEI,wCACI,UAAG,GAAG,CAAEZ,MAAR,CAAgB,SAAS,CAAEM,MAAM,CAAG,QAAH,CAAc,WAA/C,CAA4D,YAAU,WAAtE,UAAmFA,MAAnF,EADJ,cAEI,0CAFJ,cAGI,cAAM,QAAQ,CAAEM,YAAhB,wBACI,cAAO,OAAO,CAAC,UAAf,iCADJ,cAEI,0CACI,IAAI,CAAC,MADT,CAEI,EAAE,CAAC,UAFP,CAGI,GAAG,CAAEb,OAHT,CAII,YAAY,CAAC,KAJjB,EAKQI,WALR,MAMI,QAAQ,KANZ,GAFJ,cAWI,cAAO,OAAO,CAAC,UAAf,uCAXJ,cAYI,cACI,IAAI,CAAC,UADT,CAEI,EAAE,CAAC,UAFP,CAGI,QAAQ,CAAE,kBAACU,CAAD,QAAOR,OAAM,CAACQ,CAAC,CAACa,MAAF,CAASC,KAAV,CAAb,EAHd,CAII,KAAK,CAAEvB,GAJX,CAKI,QAAQ,KALZ,EAZJ,cAmBI,8CAnBJ,GAHJ,cAiCI,oGACiB,aADjB,cAEI,aAAM,SAAS,CAAC,MAAhB,uBACI,KAAC,IAAD,EAAM,EAAE,CAAC,WAAT,kDADJ,EAFJ,GAjCJ,GAFJ,CA4CH,CAlGD,CAoGA,cAAeZ,MAAf"},"metadata":{},"sourceType":"module"}